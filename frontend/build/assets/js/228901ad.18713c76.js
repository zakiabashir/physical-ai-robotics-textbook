"use strict";(globalThis.webpackChunkphysical_ai_robotics_textbook=globalThis.webpackChunkphysical_ai_robotics_textbook||[]).push([[6752],{6840:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>c,contentTitle:()=>l,default:()=>m,frontMatter:()=>r,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"chapter-2/lesson-2","title":"Lesson 2.2: Simulation: Gazebo & Unity","description":"Master robot simulation environments and physics engines","source":"@site/docs/chapter-2/lesson-2.mdx","sourceDirName":"chapter-2","slug":"/chapter-2/lesson-2","permalink":"/docs/chapter-2/lesson-2","draft":false,"unlisted":false,"editUrl":"https://github.com/physical-ai/physical-ai-robotics-textbook/tree/main/docs/chapter-2/lesson-2.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Lesson 2.2: Simulation: Gazebo & Unity","description":"Master robot simulation environments and physics engines","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Lesson 2.1: ROS 2 Fundamentals","permalink":"/docs/chapter-2/lesson-1"},"next":{"title":"Lesson 2.3: Weekly Learning Plan (Weeks 3-7)","permalink":"/docs/chapter-2/lesson-3"}}');var o=i(4848),s=i(8453),a=i(2948);const r={title:"Lesson 2.2: Simulation: Gazebo & Unity",description:"Master robot simulation environments and physics engines",sidebar_position:2},l="Lesson 2.2: Simulation: Gazebo & Unity",c={},d=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Introduction to Robot Simulation",id:"introduction-to-robot-simulation",level:2},{value:"URDF/SDF: Robot Description Formats",id:"urdfsdf-robot-description-formats",level:2},{value:"URDF (Unified Robot Description Format)",id:"urdf-unified-robot-description-format",level:3},{value:"SDF (Simulation Description Format)",id:"sdf-simulation-description-format",level:3},{value:"Gazebo Simulation",id:"gazebo-simulation",level:2},{value:"Setting Up a Gazebo World",id:"setting-up-a-gazebo-world",level:3},{value:"Gazebo Launch File with ROS 2 Integration",id:"gazebo-launch-file-with-ros-2-integration",level:3},{value:"Unity Robotics Simulation",id:"unity-robotics-simulation",level:2},{value:"Unity Scene Setup for Robot Simulation",id:"unity-scene-setup-for-robot-simulation",level:3},{value:"Unity-Wide Integration Script",id:"unity-wide-integration-script",level:3},{value:"Lab Exercise: Building a Complete Simulation",id:"lab-exercise-building-a-complete-simulation",level:2},{value:"Objective",id:"objective",level:3},{value:"Setup",id:"setup",level:3},{value:"Implementation",id:"implementation",level:3},{value:"Testing the Simulation",id:"testing-the-simulation",level:3},{value:"Expected Results",id:"expected-results",level:3},{value:"Best Practices for Robot Simulation",id:"best-practices-for-robot-simulation",level:2},{value:"1. Model Accuracy",id:"1-model-accuracy",level:3},{value:"2. Performance Optimization",id:"2-performance-optimization",level:3},{value:"3. Sensor Realism",id:"3-sensor-realism",level:3},{value:"4. Environment Design",id:"4-environment-design",level:3},{value:"Key Takeaways",id:"key-takeaways",level:2},{value:"Summary",id:"summary",level:2},{value:"Quiz",id:"quiz",level:2}];function u(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...n.components},{DiagramComponent:i,Quiz:t}=e;return i||p("DiagramComponent",!0),t||p("Quiz",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"lesson-22-simulation-gazebo--unity",children:"Lesson 2.2: Simulation: Gazebo & Unity"})}),"\n",(0,o.jsx)(e.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,o.jsxs)("div",{className:"learning-objectives",children:[(0,o.jsx)(e.p,{children:"After completing this lesson, you will be able to:"}),(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Create and configure robot models in URDF/SDF format"}),"\n",(0,o.jsx)(e.li,{children:"Set up realistic physics simulations in Gazebo"}),"\n",(0,o.jsx)(e.li,{children:"Build immersive environments in Unity Robotics"}),"\n",(0,o.jsx)(e.li,{children:"Integrate sensors and actuators in simulation"}),"\n",(0,o.jsx)(e.li,{children:"Bridge simulation with ROS 2 for testing"}),"\n"]})]}),"\n",(0,o.jsx)(e.h2,{id:"introduction-to-robot-simulation",children:"Introduction to Robot Simulation"}),"\n",(0,o.jsx)(e.p,{children:"Simulation is a cornerstone of modern robotics development, allowing us to:"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Test algorithms without risking physical hardware"}),"\n",(0,o.jsx)(e.li,{children:"Iterate quickly on designs"}),"\n",(0,o.jsx)(e.li,{children:"Generate training data for AI systems"}),"\n",(0,o.jsx)(e.li,{children:"Debug in controlled, repeatable conditions"}),"\n"]}),"\n",(0,o.jsx)(i,{title:"Simulation in Robotics Development",children:(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-mermaid",children:"graph LR\n    A[Robot Design] --\x3e B[Simulation Model]\n    B --\x3e C[Algorithm Development]\n    C --\x3e D[Virtual Testing]\n    D --\x3e E[Real World Deployment]\n\n    F[Physics Engine] --\x3e B\n    G[Environment Model] --\x3e B\n    H[Sensor Models] --\x3e B\n"})})}),"\n",(0,o.jsx)(e.h2,{id:"urdfsdf-robot-description-formats",children:"URDF/SDF: Robot Description Formats"}),"\n",(0,o.jsx)(e.h3,{id:"urdf-unified-robot-description-format",children:"URDF (Unified Robot Description Format)"}),"\n",(0,o.jsx)(e.p,{children:"URDF is an XML format that describes robot geometry, kinematics, and dynamics."}),"\n",(0,o.jsx)(a.A,{title:"Simple Robot URDF Example",language:"xml",children:(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<robot name="simple_robot">\n  \x3c!-- Base Link --\x3e\n  <link name="base_link">\n    <inertial>\n      <mass value="10"/>\n      <inertia ixx="1" ixy="0" ixz="0" iyy="1" iyz="0" izz="1"/>\n    </inertial>\n\n    <visual>\n      <geometry>\n        <box size="0.5 0.5 0.1"/>\n      </geometry>\n      <material name="blue">\n        <color rgba="0 0 1 1"/>\n      </material>\n    </visual>\n\n    <collision>\n      <geometry>\n        <box size="0.5 0.5 0.1"/>\n      </geometry>\n    </collision>\n  </link>\n\n  \x3c!-- Wheel Joint --\x3e\n  <joint name="wheel_joint" type="continuous">\n    <parent link="base_link"/>\n    <child link="wheel"/>\n    <origin xyz="0.3 0 -0.05" rpy="1.57 0 0"/>\n    <axis xyz="0 0 1"/>\n  </joint>\n\n  \x3c!-- Wheel Link --\x3e\n  <link name="wheel">\n    <inertial>\n      <mass value="1"/>\n      <inertia ixx="0.1" ixy="0" ixz="0" iyy="0.1" iyz="0" izz="0.1"/>\n    </inertial>\n\n    <visual>\n      <geometry>\n        <cylinder radius="0.1" length="0.05"/>\n      </geometry>\n      <material name="black">\n        <color rgba="0 0 0 1"/>\n      </material>\n    </visual>\n\n    <collision>\n      <geometry>\n        <cylinder radius="0.1" length="0.05"/>\n      </geometry>\n    </collision>\n  </link>\n</robot>\n'})})}),"\n",(0,o.jsx)(e.h3,{id:"sdf-simulation-description-format",children:"SDF (Simulation Description Format)"}),"\n",(0,o.jsx)(e.p,{children:"SDF extends URDF with simulation-specific properties:"}),"\n",(0,o.jsx)(a.A,{title:"Robot with Sensors in SDF",language:"xml",children:(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<sdf version="1.6">\n  <model name="robot_with_sensors">\n    \x3c!-- Robot Base --\x3e\n    <link name="base_link">\n      <pose>0 0 0.5 0 0 0</pose>\n\n      <inertial>\n        <mass>10</mass>\n        <inertia>\n          <ixx>1</ixx>\n          <ixy>0</ixy>\n          <ixz>0</ixz>\n          <iyy>1</iyy>\n          <iyz>0</iyz>\n          <izz>1</izz>\n        </inertia>\n      </inertial>\n\n      <visual name="base_visual">\n        <geometry>\n          <box>\n            <size>0.5 0.5 0.3</size>\n          </box>\n        </geometry>\n        <material>\n          <ambient>0 0 1 1</ambient>\n          <diffuse>0 0 1 1</diffuse>\n        </material>\n      </visual>\n\n      <collision name="base_collision">\n        <geometry>\n          <box>\n            <size>0.5 0.5 0.3</size>\n          </box>\n        </geometry>\n        <surface>\n          <friction>\n            <ode>\n              <mu>0.5</mu>\n            </ode>\n          </friction>\n        </surface>\n      </collision>\n    </link>\n\n    \x3c!-- Camera Sensor --\x3e\n    <link name="camera_link">\n      <pose>0.25 0 0.6 0 0 0</pose>\n\n      <sensor name="camera" type="camera">\n        <camera>\n          <horizontal_fov>1.047</horizontal_fov>\n          <image>\n            <width>640</width>\n            <height>480</height>\n          </image>\n          <clip>\n            <near>0.1</near>\n            <far>100</far>\n          </clip>\n        </camera>\n\n        <always_on>1</always_on>\n        <update_rate>30</update_rate>\n        <visualize>true</visualize>\n      </sensor>\n    </link>\n\n    \x3c!-- Joint for Camera --\x3e\n    <joint name="camera_joint" type="fixed">\n      <parent>base_link</parent>\n      <child>camera_link</child>\n    </joint>\n\n    \x3c!-- LiDAR Sensor --\x3e\n    <link name="lidar_link">\n      <pose>0 0 0.7 0 0 0</pose>\n\n      <sensor name="lidar" type="ray">\n        <ray>\n          <scan>\n            <horizontal>\n              <samples>360</samples>\n              <min_angle>-3.14159</min_angle>\n              <max_angle>3.14159</max_angle>\n            </horizontal>\n          </scan>\n          <range>\n            <min>0.1</min>\n            <max>10.0</max>\n            <resolution>0.01</resolution>\n          </range>\n        </ray>\n\n        <plugin name="lidar_plugin" filename="libgazebo_ros_ray_sensor.so">\n          <ros>\n            <namespace>/</namespace>\n            <remapping>~/out:=scan</remapping>\n          </ros>\n          <output_type>sensor_msgs/LaserScan</output_type>\n          <frame_name>lidar_link</frame_name>\n        </plugin>\n      </sensor>\n    </link>\n\n    <joint name="lidar_joint" type="fixed">\n      <parent>base_link</parent>\n      <child>lidar_link</child>\n    </joint>\n  </model>\n</sdf>\n'})})}),"\n",(0,o.jsx)(e.h2,{id:"gazebo-simulation",children:"Gazebo Simulation"}),"\n",(0,o.jsx)(e.h3,{id:"setting-up-a-gazebo-world",children:"Setting Up a Gazebo World"}),"\n",(0,o.jsx)(a.A,{title:"Custom Gazebo World",language:"xml",children:(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<sdf version="1.6">\n  <world name="robot_playground">\n\n    \x3c!-- Physics Engine Settings --\x3e\n    <physics name="1ms" type="ode">\n      <max_step_size>0.001</max_step_size>\n      <real_time_factor>1.0</real_time_factor>\n    </physics>\n\n    \x3c!-- Ground Plane --\x3e\n    <include>\n      <uri>model://ground_plane</uri>\n    </include>\n\n    \x3c!-- Sun --\x3e\n    <include>\n      <uri>model://sun</uri>\n    </include>\n\n    \x3c!-- Building 1 --\x3e\n    <model name="building1">\n      <static>true</static>\n      <pose>5 5 0 0 0 0</pose>\n\n      <link name="building_link">\n        <collision name="building_collision">\n          <geometry>\n            <box>\n              <size>4 4 6</size>\n            </box>\n          </geometry>\n        </collision>\n\n        <visual name="building_visual">\n          <geometry>\n            <box>\n              <size>4 4 6</size>\n            </box>\n          </geometry>\n          <material>\n            <ambient>0.7 0.7 0.7 1</ambient>\n            <diffuse>0.7 0.7 0.7 1</diffuse>\n          </material>\n        </visual>\n      </link>\n    </model>\n\n    \x3c!-- Obstacle Course --\x3e\n    <model name="obstacles">\n      <static>true</static>\n\n      \x3c!-- Cylindrical Obstacles --\x3e\n      <link name="cylinder1">\n        <pose>2 -1 0.5 0 0 0</pose>\n        <collision name="collision">\n          <geometry>\n            <cylinder>\n              <radius>0.3</radius>\n              <length>1</length>\n            </cylinder>\n          </geometry>\n        </collision>\n        <visual name="visual">\n          <geometry>\n            <cylinder>\n              <radius>0.3</radius>\n              <length>1</length>\n            </cylinder>\n          </geometry>\n          <material>\n            <ambient>1 0 0 1</ambient>\n          </material>\n        </visual>\n      </link>\n\n      <link name="cylinder2">\n        <pose>3 1 0.5 0 0 0</pose>\n        <collision name="collision">\n          <geometry>\n            <cylinder>\n              <radius>0.3</radius>\n              <length>1</length>\n            </cylinder>\n          </geometry>\n        </collision>\n        <visual name="visual">\n          <geometry>\n            <cylinder>\n              <radius>0.3</radius>\n              <length>1</length>\n            </cylinder>\n          </geometry>\n          <material>\n            <ambient>0 1 0 1</ambient>\n          </material>\n        </visual>\n      </link>\n\n      \x3c!-- Ramp --\x3e\n      <link name="ramp">\n        <pose>0 3 0 0 0.3 0</pose>\n        <collision name="collision">\n          <geometry>\n            <box>\n              <size>4 2 0.2</size>\n            </box>\n          </geometry>\n        </collision>\n        <visual name="visual">\n          <geometry>\n            <box>\n              <size>4 2 0.2</size>\n            </box>\n          </geometry>\n          <material>\n            <ambient>0.5 0.5 0.5 1</ambient>\n          </material>\n        </visual>\n      </link>\n    </model>\n\n    \x3c!-- Spawn Point Marker --\x3e\n    <model name="spawn_point">\n      <static>true</static>\n      <pose>0 0 0.1 0 0 0</pose>\n      <link name="spawn_marker">\n        <visual name="marker">\n          <geometry>\n            <cylinder>\n              <radius>0.2</radius>\n              <length>0.01</length>\n            </cylinder>\n          </geometry>\n          <material>\n            <ambient>0 0 1 0.5</ambient>\n          </material>\n        </visual>\n      </link>\n    </model>\n  </world>\n</sdf>\n'})})}),"\n",(0,o.jsx)(e.h3,{id:"gazebo-launch-file-with-ros-2-integration",children:"Gazebo Launch File with ROS 2 Integration"}),"\n",(0,o.jsx)(a.A,{title:"Gazebo ROS 2 Launch File",language:"python",children:(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:'# save as gazebo_simulation.launch.py\nimport os\nfrom launch import LaunchDescription\nfrom launch.actions import DeclareLaunchArgument, ExecuteProcess, IncludeLaunchDescription\nfrom launch.conditions import IfCondition\nfrom launch.launch_description_sources import PythonLaunchDescriptionSource\nfrom launch.substitutions import Command, FindExecutable, LaunchConfiguration, PathJoinSubstitution\nfrom launch_ros.actions import Node\nfrom launch_ros.substitutions import FindPackageShare\n\ndef generate_launch_description():\n\n    # Declare launch arguments\n    declared_arguments = []\n    declared_arguments.append(\n        DeclareLaunchArgument(\n            "use_sim_time",\n            default_value="true",\n            description="Use simulation (Gazebo) clock if true",\n        )\n    )\n    declared_arguments.append(\n        DeclareLaunchArgument(\n            "gui",\n            default_value="true",\n            description="Start RViz2 automatically",\n        )\n    )\n\n    # Get URDF via xacro\n    robot_description_content = Command(\n        [\n            PathJoinSubstitution([FindExecutable(name="xacro")]),\n            " ",\n            PathJoinSubstitution(\n                [FindPackageShare("physical_ai_textbook"), "urdf", "robot.urdf.xacro"]\n            ),\n        ]\n    )\n\n    robot_description = {"robot_description": robot_description_content}\n\n    # Gazebo launch\n    gazebo = IncludeLaunchDescription(\n        PythonLaunchDescriptionSource(\n            [FindPackageShare("gazebo_ros"), "/launch", "/gazebo.launch.py"]\n        ),\n        launch_arguments={"world": PathJoinSubstitution(\n            [FindPackageShare("physical_ai_textbook"), "worlds", "robot_playground.world"]\n        )}.items(),\n    )\n\n    # Robot state publisher\n    robot_state_publisher_node = Node(\n        package="robot_state_publisher",\n        executable="robot_state_publisher",\n        output="both",\n        parameters=[robot_description, {"use_sim_time": LaunchConfiguration("use_sim_time")}],\n    )\n\n    # Spawn robot in Gazebo\n    spawn_entity = Node(\n        package="gazebo_ros",\n        executable="spawn_entity.py",\n        arguments=[\n            "-topic", "robot_description",\n            "-entity", "robot",\n            "-x", "0.0",\n            "-y", "0.0",\n            "-z", "0.1"\n        ],\n        output="screen",\n    )\n\n    # Load controllers\n    load_joint_state_controller = ExecuteProcess(\n        cmd=["ros2", "control", "load_start_controller", "joint_state_broadcaster"],\n        output="screen",\n    )\n\n    load_diff_drive_controller = ExecuteProcess(\n        cmd=["ros2", "control", "load_start_controller", "diff_drive_base_controller"],\n        output="screen",\n    )\n\n    # RViz2\n    rviz_node = Node(\n        package="rviz2",\n        executable="rviz2",\n        name="rviz2",\n        output="screen",\n        arguments=["-d", PathJoinSubstitution(\n            [FindPackageShare("physical_ai_textbook"), "rviz", "robot_view.rviz"]\n        )],\n        condition=IfCondition(LaunchConfiguration("gui")),\n        parameters=[{"use_sim_time": LaunchConfiguration("use_sim_time")}],\n    )\n\n    # Navigation stack (optional)\n    nav2_bringup = IncludeLaunchDescription(\n        PythonLaunchDescriptionSource(\n            [FindPackageShare("nav2_bringup"), "/launch", "/navigation_launch.py"]\n        ),\n        launch_arguments={\n            "use_sim_time": LaunchConfiguration("use_sim_time"),\n            "map": PathJoinSubstitution(\n                [FindPackageShare("physical_ai_textbook"), "maps", "sim_map.yaml"]\n            ),\n        }.items(),\n    )\n\n    nodes = [\n        gazebo,\n        robot_state_publisher_node,\n        spawn_entity,\n        load_joint_state_controller,\n        load_diff_drive_controller,\n        rviz_node,\n        # nav2_bringup  # Uncomment if using navigation\n    ]\n\n    return LaunchDescription(declared_arguments + nodes)\n'})})}),"\n",(0,o.jsx)(e.h2,{id:"unity-robotics-simulation",children:"Unity Robotics Simulation"}),"\n",(0,o.jsx)(e.h3,{id:"unity-scene-setup-for-robot-simulation",children:"Unity Scene Setup for Robot Simulation"}),"\n",(0,o.jsx)(e.p,{children:"Unity provides high-fidelity graphics and physics for robot simulation."}),"\n",(0,o.jsx)(a.A,{title:"Unity Robot Controller Script",language:"csharp",children:(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-csharp",children:'// RobotController.cs\nusing UnityEngine;\nusing ROS2;\nusing std_msgs.msg;\nusing geometry_msgs.msg;\nusing sensor_msgs.msg;\n\npublic class RobotController : MonoBehaviour\n{\n    [Header("Robot Configuration")]\n    public float maxLinearSpeed = 2.0f;\n    public float maxAngularSpeed = 1.5f;\n    public Transform robotBase;\n\n    [Header("Sensors")]\n    public Camera robotCamera;\n    public LidarSensor lidarSensor;\n\n    // ROS 2 nodes and publishers\n    private ROS2Node ros2Node;\n    private IPublisher<Twist> cmdVelPublisher;\n    private IPublisher<Image> imagePublisher;\n    private IPublisher<LaserScan> laserPublisher;\n\n    // Robot state\n    private Vector3 currentVelocity = Vector3.zero;\n    private float currentAngularVelocity = 0f;\n\n    void Start()\n    {\n        // Initialize ROS 2\n        ROS2.UnityROS2Instance.Init();\n        ros2Node = ROS2.UnityROS2Instance.CreateNode("unity_robot_node");\n\n        // Create publishers\n        cmdVelPublisher = ros2Node.CreatePublisher<Twist>("/cmd_vel");\n        imagePublisher = ros2Node.CreatePublisher<Image>("/camera/image_raw");\n        laserPublisher = ros2Node.CreatePublisher<LaserScan>("/scan");\n\n        // Create subscribers for control commands\n        ros2Node.CreateSubscription<Twist>(\n            "/cmd_vel_unity",\n            msg => {\n                currentVelocity = new Vector3(\n                    (float)msg.Linear.X,\n                    0f,\n                    0f\n                );\n                currentAngularVelocity = (float)msg.Angular.Z;\n            }\n        );\n\n        // Start sensor data publishing\n        InvokeRepeating(nameof(PublishSensorData), 0f, 0.033f); // 30 Hz\n    }\n\n    void Update()\n    {\n        // Update robot position based on velocity commands\n        UpdateRobotPose();\n    }\n\n    void UpdateRobotPose()\n    {\n        if (robotBase == null) return;\n\n        // Apply linear velocity\n        Vector3 movement = robotBase.forward * currentVelocity.x * Time.deltaTime;\n        robotBase.position += movement;\n\n        // Apply angular velocity\n        Quaternion rotation = Quaternion.Euler(\n            0f,\n            currentAngularVelocity * Mathf.Rad2Deg * Time.deltaTime,\n            0f\n        );\n        robotBase.rotation *= rotation;\n    }\n\n    void PublishSensorData()\n    {\n        // Publish camera image\n        if (robotCamera != null)\n        {\n            PublishCameraImage();\n        }\n\n        // Publish LiDAR scan\n        if (lidarSensor != null)\n        {\n            PublishLaserScan();\n        }\n    }\n\n    void PublishCameraImage()\n    {\n        RenderTexture rt = new RenderTexture(640, 480, 24);\n        robotCamera.targetTexture = rt;\n        robotCamera.Render();\n\n        Texture2D tex = new Texture2D(640, 480, TextureFormat.RGB24, false);\n        RenderTexture.active = rt;\n        tex.ReadPixels(new Rect(0, 0, 640, 480), 0, 0);\n        tex.Apply();\n\n        // Convert to ROS2 Image message\n        Image imageMsg = new Image();\n        imageMsg.Header.Frame_id = "camera_link";\n        imageMsg.Height = (uint)tex.height;\n        imageMsg.Width = (uint)tex.width;\n        imageMsg.Encoding = "rgb8";\n        imageMsg.Is_bigendian = 0;\n        imageMsg.Step = (uint)(tex.width * 3);\n\n        // Convert texture data to byte array\n        byte[] data = tex.GetRawTextureData();\n        imageMsg.Data = data;\n\n        // Set timestamp\n        imageMsg.Header.Stamp = ROS2.Time.Now();\n\n        // Publish\n        imagePublisher.Publish(imageMsg);\n\n        // Cleanup\n        robotCamera.targetTexture = null;\n        RenderTexture.active = null;\n        Destroy(rt);\n    }\n\n    void PublishLaserScan()\n    {\n        if (!lidarSensor.IsScanning) return;\n\n        LaserScan scanMsg = new LaserScan();\n        scanMsg.Header.Frame_id = "laser_link";\n        scanMsg.Header.Stamp = ROS2.Time.Now();\n\n        // Configure scan parameters\n        scanMsg.Angle_min = -Mathf.PI;\n        scanMsg.Angle_max = Mathf.PI;\n        scanMsg.Angle_increment = 2 * Mathf.PI / lidarSensor.NumRays;\n        scanMsg.Time_increment = 0f;\n        scanMsg.Scan_time = 0.1f;\n        scanMsg.Range_min = 0.1f;\n        scanMsg.Range_max = 10f;\n\n        // Get scan data\n        float[] ranges = lidarSensor.GetRanges();\n\n        // Convert to ROS2 format\n        scanMsg.Ranges = new System.Collections.Generic.List<float>(ranges);\n\n        // Publish\n        laserPublisher.Publish(scanMsg);\n    }\n\n    void OnApplicationQuit()\n    {\n        // Clean up ROS 2\n        ROS2.UnityROS2Instance.Shutdown();\n    }\n}\n'})})}),"\n",(0,o.jsx)(e.h3,{id:"unity-wide-integration-script",children:"Unity-Wide Integration Script"}),"\n",(0,o.jsx)(a.A,{title:"Unity-ROS2 Bridge",language:"csharp",children:(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-csharp",children:'// UnityROS2Bridge.cs\nusing UnityEngine;\nusing ROS2;\nusing System.Collections;\n\npublic class UnityROS2Bridge : MonoBehaviour\n{\n    [Header("Bridge Settings")]\n    public string rosNamespace = "";\n    public bool enablePointCloud = true;\n    public bool enableTF = true;\n\n    private ROS2Node bridgeNode;\n    private TFPublisher tfPublisher;\n\n    void Start()\n    {\n        StartCoroutine(InitializeBridge());\n    }\n\n    IEnumerator InitializeBridge()\n    {\n        // Wait for ROS2 to initialize\n        yield return new WaitForSeconds(1f);\n\n        // Create bridge node\n        bridgeNode = ROS2.UnityROS2Instance.CreateNode("unity_bridge");\n\n        // Initialize TF publisher if enabled\n        if (enableTF)\n        {\n            tfPublisher = gameObject.AddComponent<TFPublisher>();\n            tfPublisher.Initialize(bridgeNode);\n        }\n\n        // Setup additional ROS2 services and actions\n        SetupROSServices();\n\n        Debug.Log("Unity-ROS2 Bridge initialized");\n    }\n\n    void SetupROSServices()\n    {\n        // Example: Spawn service to spawn objects in Unity\n        bridgeNode.CreateService<SpawnObject.srv, SpawnObject.srv_Request, SpawnObject.srv_Response>(\n            "spawn_object",\n            HandleSpawnRequest\n        );\n\n        // Example: Get pose service\n        bridgeNode.CreateService<GetPose.srv, GetPose.srv_Request, GetPose.srv_Response>(\n            "get_pose",\n            HandleGetPoseRequest\n        );\n    }\n\n    private SpawnObject.srv_Response HandleSpawnRequest(SpawnObject.srv_Request request)\n    {\n        var response = new SpawnObject.srv_Response();\n\n        try\n        {\n            // Spawn object at specified position\n            GameObject prefab = Resources.Load<GameObject>(request.Model_name);\n            if (prefab != null)\n            {\n                Vector3 position = new Vector3(\n                    (float)request.Pose.Position.X,\n                    (float)request.Pose.Position.Y,\n                    (float)request.Pose.Position.Z\n                );\n\n                Quaternion orientation = new Quaternion(\n                    (float)request.Pose.Orientation.X,\n                    (float)request.Pose.Orientation.Y,\n                    (float)request.Pose.Orientation.Z,\n                    (float)request.Pose.Orientation.W\n                );\n\n                Instantiate(prefab, position, orientation);\n                response.Success = true;\n                response.Message = "Object spawned successfully";\n            }\n            else\n            {\n                response.Success = false;\n                response.Message = $"Model \'{request.Model_name}\' not found";\n            }\n        }\n        catch (System.Exception e)\n        {\n            response.Success = false;\n            response.Message = e.Message;\n        }\n\n        return response;\n    }\n\n    private GetPose.srv_Response HandleGetPoseRequest(GetPose.srv_Request request)\n    {\n        var response = new GetPose.srv_Response();\n\n        // Find object by name\n        GameObject obj = GameObject.Find(request.Object_name);\n        if (obj != null)\n        {\n            response.Pose.Position.X = obj.transform.position.x;\n            response.Pose.Position.Y = obj.transform.position.y;\n            response.Pose.Position.Z = obj.transform.position.z;\n\n            response.Pose.Orientation.X = obj.transform.rotation.x;\n            response.Pose.Orientation.Y = obj.transform.rotation.y;\n            response.Pose.Orientation.Z = obj.transform.rotation.z;\n            response.Pose.Orientation.W = obj.transform.rotation.w;\n\n            response.Success = true;\n        }\n        else\n        {\n            response.Success = false;\n        }\n\n        return response;\n    }\n\n    void Update()\n    {\n        // Publish TF data if enabled\n        if (tfPublisher != null)\n        {\n            tfPublisher.PublishTransforms();\n        }\n    }\n\n    void OnApplicationQuit()\n    {\n        // Cleanup\n        if (bridgeNode != null)\n        {\n            bridgeNode.Dispose();\n        }\n    }\n}\n'})})}),"\n",(0,o.jsx)(e.h2,{id:"lab-exercise-building-a-complete-simulation",children:"Lab Exercise: Building a Complete Simulation"}),"\n",(0,o.jsxs)("div",{className:"lab-exercise",children:[(0,o.jsx)(e.h3,{id:"objective",children:"Objective"}),(0,o.jsx)(e.p,{children:"Create a complete robot simulation environment with physics, sensors, and ROS 2 integration."}),(0,o.jsx)(e.h3,{id:"setup",children:"Setup"}),(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsx)(e.li,{children:"Create a robot URDF model"}),"\n",(0,o.jsx)(e.li,{children:"Build a Gazebo world with obstacles"}),"\n",(0,o.jsx)(e.li,{children:"Set up Unity environment with realistic graphics"}),"\n",(0,o.jsx)(e.li,{children:"Implement sensor simulation"}),"\n",(0,o.jsx)(e.li,{children:"Connect everything through ROS 2"}),"\n"]}),(0,o.jsx)(e.h3,{id:"implementation",children:"Implementation"}),(0,o.jsx)(a.A,{language:"python",editable:!0,children:(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:'# First, create the robot URDF file (robot.urdf.xacro)\nrobot_urdf = \'\'\'<?xml version="1.0"?>\n<robot name="diff_drive_robot" xmlns:xacro="http://www.ros.org/wiki/xacro">\n\n  \x3c!-- Define robot properties --\x3e\n  <xacro:property name="wheel_radius" value="0.1"/>\n  <xacro:property name="wheel_width" value="0.05"/>\n  <xacro:property name="wheel_base" value="0.3"/>\n  <xacro:property name="base_height" value="0.1"/>\n\n  \x3c!-- Base Link --\x3e\n  <link name="base_link">\n    <pose>0 0 0 0 0 0</pose>\n\n    <inertial>\n      <mass value="5"/>\n      <inertia ixx="0.1" ixy="0" ixz="0" iyy="0.1" iyz="0" izz="0.1"/>\n    </inertial>\n\n    <visual name="base_visual">\n      <geometry>\n        <cylinder radius="0.2" length="0.1"/>\n      </geometry>\n      <material name="blue">\n        <color rgba="0 0.5 1 1"/>\n      </material>\n    </visual>\n\n    <collision name="base_collision">\n      <geometry>\n        <cylinder radius="0.2" length="0.1"/>\n      </geometry>\n    </collision>\n  </link>\n\n  \x3c!-- Left Wheel --\x3e\n  <link name="left_wheel">\n    <pose>${wheel_base/2} 0 0 0 1.57 0</pose>\n\n    <inertial>\n      <mass value="0.5"/>\n      <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>\n    </inertial>\n\n    <visual name="left_wheel_visual">\n      <geometry>\n        <cylinder radius="${wheel_radius}" length="${wheel_width}"/>\n      </geometry>\n      <material name="black">\n        <color rgba="0.1 0.1 0.1 1"/>\n      </material>\n    </visual>\n\n    <collision name="left_wheel_collision">\n      <geometry>\n        <cylinder radius="${wheel_radius}" length="${wheel_width}"/>\n      </geometry>\n    </collision>\n  </link>\n\n  \x3c!-- Right Wheel --\x3e\n  <link name="right_wheel">\n    <pose>-${wheel_base/2} 0 0 0 1.57 0</pose>\n\n    <inertial>\n      <mass value="0.5"/>\n      <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>\n    </inertial>\n\n    <visual name="right_wheel_visual">\n      <geometry>\n        <cylinder radius="${wheel_radius}" length="${wheel_width}"/>\n      </geometry>\n      <material name="black">\n        <color rgba="0.1 0.1 0.1 1"/>\n      </material>\n    </visual>\n\n    <collision name="right_wheel_collision">\n      <geometry>\n        <cylinder radius="${wheel_radius}" length="${wheel_width}"/>\n      </geometry>\n    </collision>\n  </link>\n\n  \x3c!-- Joints --\x3e\n  <joint name="left_wheel_joint" type="continuous">\n    <parent link="base_link"/>\n    <child link="left_wheel"/>\n    <axis xyz="0 0 1"/>\n  </joint>\n\n  <joint name="right_wheel_joint" type="continuous">\n    <parent link="base_link"/>\n    <child link="right_wheel"/>\n    <axis xyz="0 0 1"/>\n  </joint>\n\n  \x3c!-- Camera Link --\x3e\n  <link name="camera_link">\n    <pose>0 0 0.15 0 0 0</pose>\n\n    <inertial>\n      <mass value="0.1"/>\n      <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001"/>\n    </inertial>\n  </link>\n\n  <joint name="camera_joint" type="fixed">\n    <parent link="base_link"/>\n    <child link="camera_link"/>\n  </joint>\n</robot>\'\'\'\n\n# Save this to a file and use it in your simulation setup\nimport numpy as np\n\nclass SimulationEnvironment:\n    def __init__(self):\n        self.obstacles = []\n        self.robot_pose = [0, 0, 0]\n        self.sensor_data = {}\n\n    def add_obstacle(self, position, size, shape=\'box\'):\n        """Add an obstacle to the environment"""\n        self.obstacles.append({\n            \'position\': position,\n            \'size\': size,\n            \'shape\': shape\n        })\n\n    def check_collision(self, position, robot_radius=0.2):\n        """Check if position collides with any obstacle"""\n        for obs in self.obstacles:\n            if obs[\'shape\'] == \'box\':\n                # Simple box collision\n                dx = abs(position[0] - obs[\'position\'][0])\n                dy = abs(position[1] - obs[\'position\'][1])\n                if (dx < (obs[\'size\'][0]/2 + robot_radius) and\n                    dy < (obs[\'size\'][1]/2 + robot_radius)):\n                    return True\n        return False\n\n    def simulate_lidar(self, robot_pose, num_rays=360, max_range=5.0):\n        """Simulate LiDAR sensor data"""\n        angles = np.linspace(-np.pi, np.pi, num_rays)\n        ranges = []\n\n        for angle in angles:\n            # Cast ray from robot position\n            range_to_obstacle = max_range\n\n            for obs in self.obstacles:\n                # Simple ray-box intersection\n                obs_dist = self.ray_box_intersection(\n                    robot_pose, angle,\n                    obs[\'position\'], obs[\'size\']\n                )\n                if obs_dist < range_to_obstacle:\n                    range_to_obstacle = obs_dist\n\n            ranges.append(range_to_obstacle)\n\n        return {\n            \'angle_min\': -np.pi,\n            \'angle_max\': np.pi,\n            \'angle_increment\': 2 * np.pi / num_rays,\n            \'ranges\': ranges\n        }\n\n    def ray_box_intersection(self, origin, angle, box_pos, box_size):\n        """Calculate ray-box intersection distance"""\n        # Simplified implementation\n        dx = box_pos[0] - origin[0]\n        dy = box_pos[1] - origin[1]\n\n        # Calculate closest point on box to ray\n        closest_x = max(box_pos[0] - box_size[0]/2,\n                       min(box_pos[0] + box_size[0]/2, origin[0]))\n        closest_y = max(box_pos[1] - box_size[1]/2,\n                       min(box_pos[1] + box_size[1]/2, origin[1]))\n\n        # Distance to closest point\n        dist = np.sqrt((closest_x - origin[0])**2 + (closest_y - origin[1])**2)\n\n        return dist\n\n# Create simulation environment\nsim = SimulationEnvironment()\n\n# Add some obstacles\nsim.add_obstacle([2, 0, 0], [0.5, 0.5, 1], \'box\')\nsim.add_obstacle([0, 3, 0], [1, 0.5, 1], \'box\')\nsim.add_obstacle([-2, -2, 0], [0.8, 0.8, 1], \'box\')\n\n# Simulate LiDAR at robot position\nlidar_data = sim.simulate_lidar([0, 0, 0])\nprint(f"Simulated LiDAR ranges: {len(lidar_data[\'ranges\'])} rays")\nprint(f"Min range: {min(lidar_data[\'ranges\']):.2f}m")\n\n# Check for collisions\ntest_positions = [[1, 1, 0], [2.5, 0, 0], [0, 2.5, 0]]\nfor pos in test_positions:\n    collision = sim.check_collision(pos)\n    print(f"Position {pos}: {\'Collision!\' if collision else \'Clear\'}")\n'})})}),(0,o.jsx)(e.h3,{id:"testing-the-simulation",children:"Testing the Simulation"}),(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Launch Gazebo"}),":"]}),"\n"]}),(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"ros2 launch physical_ai_textbook gazebo_simulation.launch.py\n"})}),(0,o.jsxs)(e.ol,{start:"2",children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Control the robot"}),":"]}),"\n"]}),(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:'ros2 topic pub /cmd_vel geometry_msgs/msg/Twist "{linear: {x: 0.5}, angular: {z: 0.0}}"\n'})}),(0,o.jsxs)(e.ol,{start:"3",children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"View sensor data"}),":"]}),"\n"]}),(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"ros2 topic echo /scan\nros2 topic echo /camera/image_raw\n"})}),(0,o.jsx)(e.h3,{id:"expected-results",children:"Expected Results"}),(0,o.jsx)(e.p,{children:"The simulation should demonstrate:"}),(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Accurate physics simulation"}),"\n",(0,o.jsx)(e.li,{children:"Realistic sensor data"}),"\n",(0,o.jsx)(e.li,{children:"Smooth robot control"}),"\n",(0,o.jsx)(e.li,{children:"Collision detection"}),"\n"]})]}),"\n",(0,o.jsx)(e.h2,{id:"best-practices-for-robot-simulation",children:"Best Practices for Robot Simulation"}),"\n",(0,o.jsx)(e.h3,{id:"1-model-accuracy",children:"1. Model Accuracy"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Match physical properties (mass, inertia)"}),"\n",(0,o.jsx)(e.li,{children:"Include all relevant sensors"}),"\n",(0,o.jsx)(e.li,{children:"Validate against real robot"}),"\n"]}),"\n",(0,o.jsx)(e.h3,{id:"2-performance-optimization",children:"2. Performance Optimization"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Use appropriate physics timestep"}),"\n",(0,o.jsx)(e.li,{children:"Optimize collision meshes"}),"\n",(0,o.jsx)(e.li,{children:"Balance detail vs performance"}),"\n"]}),"\n",(0,o.jsx)(e.h3,{id:"3-sensor-realism",children:"3. Sensor Realism"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Add noise and bias"}),"\n",(0,o.jsx)(e.li,{children:"Simulate real sensor constraints"}),"\n",(0,o.jsx)(e.li,{children:"Include occlusion effects"}),"\n"]}),"\n",(0,o.jsx)(e.h3,{id:"4-environment-design",children:"4. Environment Design"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Start simple, add complexity"}),"\n",(0,o.jsx)(e.li,{children:"Include challenging scenarios"}),"\n",(0,o.jsx)(e.li,{children:"Test edge cases"}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"key-takeaways",children:"Key Takeaways"}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Simulation accelerates development"})," - Test without risking hardware"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"URDF/SDF define robot structure"})," - Essential for physics and visualization"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Gazebo provides realistic physics"})," - Industry standard for robotics"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Unity adds visual fidelity"})," - Excellent for AI training and demos"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"ROS 2 bridges everything"})," - Unified interface for simulation and reality"]}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"summary",children:"Summary"}),"\n",(0,o.jsx)(e.p,{children:"Simulation environments are indispensable for modern robotics development. They provide safe, efficient, and repeatable testing grounds for algorithms before deploying on physical hardware. By mastering Gazebo and Unity integration with ROS 2, you can create comprehensive test beds that accelerate your development cycle and improve system reliability."}),"\n",(0,o.jsxs)(e.p,{children:["In the next lesson, we'll explore the ",(0,o.jsx)(e.strong,{children:"weekly learning plan"})," for Weeks 3-7, integrating everything we've learned about ROS 2 and simulation."]}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.a,{href:"lesson-3",children:"Next: Weekly Learning Plan (Weeks 3-7) \u2192"})}),"\n",(0,o.jsx)(e.h2,{id:"quiz",children:"Quiz"}),"\n",(0,o.jsx)(t,{quizId:"simulation-gazebo-unity",questions:[{id:"q1",type:"multiple-choice",question:"What is the primary difference between URDF and SDF?",options:["URDF is for 2D robots, SDF is for 3D robots","SDF includes simulation-specific properties beyond URDF","URDF uses JSON, SDF uses XML","There is no difference; they're the same format"],correct:1,explanation:"SDF (Simulation Description Format) extends URDF with simulation-specific properties like physics parameters, sensor configurations, and environment settings that URDF doesn't support."},{id:"q2",type:"multiple-choice",question:"Which physics engine does Gazebo use by default?",options:["Bullet Physics","PhysX","ODE (Open Dynamics Engine)","Havok Physics"],correct:2,explanation:"Gazebo uses ODE (Open Dynamics Engine) as its default physics engine, though it can be configured to use others like Bullet."},{id:"q3",type:"true-false",question:"Unity Robotics requires a separate physics engine plugin for accurate robot simulation.",correct:!1,explanation:"Unity has its own built-in physics engine (PhysX) that provides accurate physics simulation out of the box. The Unity Robotics package provides ROS 2 integration and additional robotics-specific features."}]})]})}function m(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(u,{...n})}):u(n)}function p(n,e){throw new Error("Expected "+(e?"component":"object")+" `"+n+"` to be defined: you likely forgot to import, pass, or provide it.")}},8453:(n,e,i)=>{i.d(e,{R:()=>a,x:()=>r});var t=i(6540);const o={},s=t.createContext(o);function a(n){const e=t.useContext(s);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:a(n.components),t.createElement(s.Provider,{value:e},n.children)}}}]);